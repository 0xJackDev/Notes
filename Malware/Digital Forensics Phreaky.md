
This is A Hackthebox Medium CTF for digital foresnics. It has a .pcap file


also the password is hackthebox idk why that isnt anywhere

T*Z)
EV @@Do}'rPW9L
x0fGET /ubuntu/dists/jammy-security/main/binary-amd64/by-hash/SHA256/19598c954cf39abf05341db85f594a7803cf39a73fbc85f97586aff813dbf8a1 HTTP/1.1
Host: gb.archive.ubuntu.com
Cache-Control: max-age=0
Accept: text/*
User-Agent: Debian APT-HTTP/1.3 (2.4.6) non-interactive

GET /ubuntu/dists/jammy-security/universe/binary-amd64/by-hash/SHA256/e6c0c7a34ab293a440e63c553d15985306f5b5d785900c830551fa96f40cea72 HTTP/1.1
Host: gb.archive.ubuntu.com
Cache-Control: max-age=0
Accept: text/*
User-Agent: Debian APT-HTTP/1.3 (2.4.6) non-interactive


Ok the hackers seen to take control of a email server It starts with a TCP request And then there are some DNS requests 3239 943.432827 192.168.68.111 194.168.4.100 DNS 98 Standard query 0xbf1b PTR 108.68.168.192.in-addr.arpa OPT 3240 943.450049 194.168.4.100 192.168.68.111 DNS 98 Standard query response 0xbf1b No such name PTR 108.68.168.192.in-addr.arpa OPT 3241 943.450114 192.168.68.111 194.168.4.100 DNS 87 Standard query 0xbf1b PTR 108.68.168.192.in-addr.arpa Then there is a SMTP message with the attackers saying 3243 943.467750 192.168.68.111 192.168.68.108 SMTP 109 S: 220 The Phreaks Mail Server - We run this After that There is some more TCP and SMTP connections and then theres alot more stuff but then there is TLS


OK so i look up SMTP abd u fubd tgat tget sebt a zip file in MINE format from caleb@thephreaks,com


With the password of xh161WSxx7tB

Also this is on line 3255

There is alot of stuff sent over SMTP. since there was a zip file sent with a password this szip file was put into smtp.data.fragments . Luckily we can search for SMTP data fragments

Then we can right click on the top one and follow as TCP stream in wireshark and this is what happens


```
220 The Phreaks Mail Server - We run this

  

HELO phreak-ubuntu01

  

250 mailserver-phreak

  

MAIL FROM:<caleb@thephreaks.com>

  

250 2.1.0 Ok

  

RCPT TO:<resources@thetalents.com>

  

250 2.1.5 Ok

  

DATA

  

354 End data with <CR><LF>.<CR><LF>

  

Date: Wed, 06 Mar 2024 14:59:12 +0000

From: caleb@thephreaks.com(Caleb)

To: resources@thetalents.com

Subject: Secure File Transfer

Message-ID: <20240306145912.3RkED%caleb@thephreaks.com>

User-Agent: s-nail v14.9.23

MIME-Version: 1.0

Content-Type: multipart/mixed;

boundary="=-=DBZhoU35m_YtHyGmIsZszrXoWQVlI-1y1rd3=-="

  

This is a multi-part message in MIME format.

  

--=-=DBZhoU35m_YtHyGmIsZszrXoWQVlI-1y1rd3=-=

Content-Type: text/plain; charset=us-ascii

Content-Disposition: inline

Content-ID: <20240306145912.g2I1r%caleb@thephreaks.com>

  

Attached is a part of the file. Password: S3W8yzixNoL8

  

--=-=DBZhoU35m_YtHyGmIsZszrXoWQVlI-1y1rd3=-=

Content-Type: application/zip

Content-Transfer-Encoding: base64

Content-Disposition: attachment;

filename*0="caf33472c6e0b2de339c1de893f78e67088cd6b1586a581c6f8e87b5596";

filename*1="efcfd.zip"

Content-ID: <20240306145912.Emuab%caleb@thephreaks.com>

  

UEsDBBQACQAIAGZ3ZlhwRyBT2gAAAN0AAAAWABwAcGhyZWFrc19wbGFuLnBkZi5wYXJ0MVVUCQAD

wIToZcCE6GV1eAsAAQToAwAABOgDAAA9mPwEVmy1t/sLJ62NzXeCBFSSSZppyIzvPXL++cJbuCeL

nP4XXiAK9/HZL9xRw4LjlDf5eDd6BgBOKZqSn6qpM6g1WKXriS7k3lx5VkNnqlqQIfYnUdOCnkD/

1vzCyhuGdHPia5lmy0HoG+qdXABlLyNDgxvB9FTOcXK7oDHBOf3kmLSQFdxXsjfooLtBtC+y4gdB

xB4V3bImQ8TB5sPY55dvEKWCJ34CzRJbgIIirkD2GDIoQEHznvJA7zNnOvce1hXGA2+P/XmHe+4K

tL/fmrWMVpQEd+/GQlBLBwhwRyBT2gAAAN0AAABQSwECHgMUAAkACABmd2ZYcEcgU9oAAADdAAAA

FgAYAAAAAAAAAAAAtIEAAAAAcGhyZWFrc19wbGFuLnBkZi5wYXJ0MVVUBQADwIToZXV4CwABBOgD

AAAE6AMAAFBLBQYAAAAAAQABAFwAAAA6AQAAAAA=

  

--=-=DBZhoU35m_YtHyGmIsZszrXoWQVlI-1y1rd3=-=--

.

  

250 2.0.0 Ok: queued as 9CB872113

  

QUIT

  

221 2.0.0 Bye
```



https://base64.guru/converter/decode/file


I use this website to convert base64 into a zip file


which gives me 

application.zip

I use the password i got and decrypt it


And I get 

phreaks_plan.pdf.part1


This leads me to believe there is multiple parts but inside of the smtp.data.fragments i only see that single tcp stream



Okay but I look for smtp in wireshark and start following TCP streams and BOOM I find another Ill only put the important parts


```
Attached is a part of the file. Password: j2SRRDraIvUZ


UEsDBBQACQAIAGZ3Zlgub1pG0gAAAN0AAAAWABwAcGhyZWFrc19wbGFuLnBkZi5wYXJ0NlVUCQAD

wIToZcCE6GV1eAsAAQToAwAABOgDAAA9siVDz34UldbdpmALh3n3JpC5DSTu5/F8fuitjI/IDhbW

yDabhamKNp1fsz7hThUnyS6ibIdFtg+YKTm+Tg8Xba1jM0AAf7r/dIGjDciCXGpH2IzkV/7qgbK2

5jIufslNzO0T3tCviOj4q5un2zfP+wPxD8cozyoXPmk53btd+Tyt7eGbQ8r9LaLSAxl+LXrUWe9L

rxeNTDehMoP+oYG2Wp/xW4Xe7cVHSyXYFa1C/6Fs/uZZv2d1N7+jDBCOpFNSUfwMLeNQSZ3js6RU

+DjUWARQSwcILm9aRtIAAADdAAAAUEsBAh4DFAAJAAgAZndmWC5vWkbSAAAA3QAAABYAGAAAAAAA

AAAAALSBAAAAAHBocmVha3NfcGxhbi5wZGYucGFydDZVVAUAA8CE6GV1eAsAAQToAwAABOgDAABQ

SwUGAAAAAAEAAQBcAAAAMgEAAAAA
```


Pass:
j2SRRDraIvUZ


Ok but wait that was .part6 ....


Ok so lets just See alll the TCP streams

tcp.stream eq 1
*This is the FIRST tcp stream and it is .part1 of the plan*


Ok lets go to 
tcp.stream eq 2


Heres where it gets difficult. It is encrypted with TLSv1.2



Ok well I dont know how many parts there is to this So I notice In 

tcp.stream eq 3 


There is More emails with .zip files with a password. Im gonna try to write a python program to look for packets with the raw data "Password" in it then display the whole packets content to make this simplier




tcp.stream eq 3


Ngl I just walked through these TCP streams and then just used this website to download each one

https://base64.guru/converter/decode/file



I started to notice a pattern within wireshark while filtering through

tcp.stream eq 16 

Every other TCP packet stream would be a TLS encrypted SMTP traffic. While say tcp.stream 17 would be the zip file im looking for


This is pretty much it.

And by tcp.stream eq 30 I had all 15 parts of this pdf to put back together.



cat $(ls phreaks_plan.pdf.part* | sort -V) > phreakhtb.pdf


I use The command above to put all parts together in order of 1 -15 and then I open this up in a pdf viewer and get the flag!